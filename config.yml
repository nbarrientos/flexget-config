secrets: secrets.yaml
templates:
  tvshows:
    exists_series:
      - /media/05b91400-5855-4e9d-980c-b9e4f20f29dc/torrent/downloads
      - /media/05b91400-5855-4e9d-980c-b9e4f20f29dc/torrent/incomplete
    transmission:
      host: localhost
      port: 9091
      username: '{{ secrets.transmission.user }}'
      password: '{{ secrets.transmission.passwd }}'
      addpaused: no
      path: /media/05b91400-5855-4e9d-980c-b9e4f20f29dc/torrent/downloads

tasks:
  rtt:
    rss: "https://revolutiontt.me/rss.php?feed=dl&bookmarks=on&passkey={{ secrets.rtt.passkey }}"
    accept_all: yes
    template: tvshows
    pushbullet:
      apikey: '{{ secrets.pb.apikey }}'
      title: "Torrent added"
      body: "{{title}}"

  cleanup:
    clean_transmission:
      host: localhost
      port: 9091
      username: '{{ secrets.transmission.user }}'
      password: '{{ secrets.transmission.passwd }}'
      finished_for: 15 days
      min_ratio: 1
      delete_files: yes

  unpack:
    find:
      path: /media/05b91400-5855-4e9d-980c-b9e4f20f29dc/torrent/downloads
      recursive: true
      regexp: .*\.(rar)$
    accept_all: true
    only_new: yes
    seen: local
    require_field: series_name
    series:
      include:
        - tvshows.yaml
      settings:
        series:
          parse_only: true
    regexp:
      reject:
        - sample
    set:
      output_folder: /media/05b91400-5855-4e9d-980c-b9e4f20f29dc/data/Shows
    pushbullet:
      apikey: '{{ secrets.pb.apikey }}'
      title: "Torrent extracted"
      body: "{{location}}"
    exec: mkdir -p {{ output_folder }}/{{ series_name|replace(' ','\ ') }}/Season\ {{ series_season }} && unrar e -r -o- {{ location }} {{ output_folder }}/{{ series_name|replace(' ','\ ') }}/Season\ {{ series_season }} && cp {{ location | pathdir }}/*.nfo {{ output_folder }}/{{ series_name|replace(' ','\ ') }}/Season\ {{ series_season }} && /bin/bash /home/xbian/.flexget/xbmc-upd.sh
